---
import { fetchStrapi, type Testimonial } from "../lib/strapi";
import TestimonialComponent from "./Testimonial.astro";

// Fetch testimonials and filter for featured ones
const testimonialsResponse = await fetchStrapi<Testimonial>("testimonials?populate=avatar&filters[isFeatured][$eq]=true");
const strapiTestimonials = testimonialsResponse?.data || [];

// Mock testimonials as fallback
const mockTestimonials: Testimonial[] = [
  {
    id: 1,
    attributes: {
      customerName: "Maria Rodriguez",
      review: "The best restaurant in town! The food is always fresh and flavorful. My family and I come here every weekend. The staff is incredibly friendly and the atmosphere is perfect for dining.",
      rating: 5,
      title: "Regular Customer",
      isVerified: true,
      isFeatured: true,
      avatar: {
        data: {
          id: 1,
          attributes: {
            url: "https://randomuser.me/api/portraits/women/44.jpg",
            alternativeText: "Maria Rodriguez",
            width: 150,
            height: 150,
          }
        }
      }
    }
  },
  {
    id: 2,
    attributes: {
      customerName: "James Chen",
      review: "Outstanding food quality and presentation. Every dish is a masterpiece! The chef really knows how to combine flavors. I've tried many items on the menu and haven't been disappointed once.",
      rating: 5,
      title: "Food Enthusiast",
      isVerified: true,
      isFeatured: true,
      avatar: {
        data: {
          id: 2,
          attributes: {
            url: "https://randomuser.me/api/portraits/men/32.jpg",
            alternativeText: "James Chen",
            width: 150,
            height: 150,
          }
        }
      }
    }
  },
  {
    id: 3,
    attributes: {
      customerName: "Sarah Thompson",
      review: "Amazing experience from start to finish. The service was impeccable and the food exceeded all expectations. Perfect place for special occasions or just a great meal out. Highly recommend!",
      rating: 5,
      title: "Happy Diner",
      isVerified: false,
      isFeatured: true,
      avatar: {
        data: {
          id: 3,
          attributes: {
            url: "https://randomuser.me/api/portraits/women/68.jpg",
            alternativeText: "Sarah Thompson",
            width: 150,
            height: 150,
          }
        }
      }
    }
  }
];

// Use Strapi data if available, otherwise use mock data
const testimonials = strapiTestimonials.length > 0 ? strapiTestimonials : mockTestimonials;
---

<section class="py-20 bg-cream-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <h2 class="text-4xl font-bold text-center mb-4 text-primary-600">
      What Our Customers Say
    </h2>
    <p class="text-center text-gray-600 mb-12 text-lg">
      Real reviews from real people who love our food
    </p>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {testimonials.map((testimonial) => (
        <TestimonialComponent item={testimonial} />
      ))}
    </div>
  </div>
</section>
